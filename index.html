<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essential Life Skills Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
		body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, rgba(44, 62, 80, 0.5) 0%, rgba(52, 152, 219, 0.2) 50%); min-height: 100vh; padding: 0; margin: 0; }
        .container { max-width: 100%; width: 100%; margin: 0; padding: 0; background: transparent; border-radius: 0; box-shadow: none; overflow: hidden; opacity: 0; transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out; }
		.header { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; padding: 40px 30px; text-align: center; position: relative; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 16px; }
		.header .editable:focus { outline: 2px solid #fff; background: rgba(255, 255, 255, 0.2); color: #fff; }
		.header .editable-icon { cursor: pointer; margin-right: 8px; font-size: 32px;}
		.guide-menu-btn { position: absolute; top: 10px; left: 10px; background: none; color: white; border: none; padding: 8px; cursor: pointer; font-size: 24px; font-weight: 600; transition: all 0.3s ease; line-height: 1; z-index: 10; }
		.guide-menu-btn:hover { opacity: 0.7; }
		.guide-dropdown { display: block; position: fixed; top: 0; left: -350px; width: 350px; height: 100vh; background: white; box-shadow: 2px 0 12px rgba(0,0,0,0.15); z-index: 2000; overflow-y: auto; transition: left 0.3s ease-in-out; padding-top: 60px; }
		.guide-dropdown.show { left: 0; }
		.guide-dropdown button { width: 100%; padding: 16px 20px; border: none; background: none; text-align: left; cursor: pointer; font-size: 15px; color: #2c3e50; transition: background 0.2s; border-bottom: 1px solid #f0f0f0; }
		.guide-dropdown button:hover { background: #f8f9fa; }
		.guide-dropdown button:last-child { border-bottom: none; }
		.guide-dropdown .new-guide-btn { background: #27ae60; color: white; font-weight: bold; margin: 10px; width: calc(100% - 20px); border-radius: 8px; }
		.guide-dropdown .new-guide-btn:hover { background: #229954; }
		.guide-dropdown .current-guide { background: rgba(25, 118, 210, 0.2); font-weight: 600; color: #1976d2; }
        .dropdown-menu { display: none; position: absolute; top: 40px;  right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); min-width: 150px; z-index: 1000;}
		.dropdown-menu.show { display: block;}
		.dropdown-menu button { width: 100%; padding: 12px 16px; border: none; background: none; text-align: left; cursor: pointer; font-size: 14px; color: #2c3e50; transition: background 0.2s;}
		.dropdown-menu button:hover { background: #f8f9fa;}
		.dropdown-menu button:first-child { border-radius: 8px 8px 0 0;}
		.dropdown-menu button:last-child { border-radius: 0 0 8px 8px;}
		.menu-open .container { transform: translateX(350px); }
		.menu-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1500; opacity: 0; transition: opacity 0.3s ease-in-out; }
		.menu-overlay.show { display: block; opacity: 1; }
		.menu-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 28px; color: #2c3e50; cursor: pointer; padding: 5px 10px; line-height: 1; }
		.menu-close-btn:hover { color: #e74c3c; }
		.menu-header { padding: 20px; background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; margin-bottom: 10px; }
		.menu-header h3 { margin: 0; font-size: 18px; }
		.color-picker-menu { display: none; background: white; border-radius: 8px; padding: 15px; margin-top: 5px; }
		.color-picker-menu.show { display: block; }
		.color-picker-menu h3 { margin: 0 0 10px 0; font-size: 14px; color: #2c3e50; }
		.color-options { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
		.color-option { width: 40px; height: 40px; border-radius: 8px; border: 2px solid transparent; cursor: pointer; transition: all 0.2s ease; }
		.color-option:hover { transform: scale(1.1); border-color: #2c3e50; }
		.color-option.selected { border-color: #2c3e50; border-width: 3px; }
		.edit-toggle { position: absolute; top: 10px; right: 10px; }
        .edit-btn { background: none; color: white; border: none; padding: 4px 8px; cursor: pointer; font-size: 28px; font-weight: 600; transition: all 0.3s ease; line-height: 1;}
        .edit-btn:hover { opacity: 0.7; }
		.save-btn { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); background: #27ae60; color: white; border: none; padding: 12px 24px; cursor: pointer; font-size: 16px; font-weight: 600; border-radius: 8px; box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4); transition: all 0.3s ease; display: none; z-index: 1000; }
		.save-btn:hover { background: #229954; transform: translateX(-50%) translateY(-2px); box-shadow: 0 6px 16px rgba(39, 174, 96, 0.5); }
		.save-btn.show { display: block; animation: fadeIn 0.3s ease-in-out; }
		.emoji-picker {  position: absolute;  background: white;  border: 1px solid #ccc;  border-radius: 8px; padding: 8px; display: grid; grid-template-columns: repeat(8, 30px);  gap: 5px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 300px; overflow-y: auto;}
		.emoji-picker button { font-size: 20px; background: none;  border: none;  cursor: pointer; transition: transform 0.2s;}
		.emoji-picker button:hover { transform: scale(1.2);}
        .nav-tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #dee2e6; overflow-x: auto; flex-wrap: wrap; }
        .tab-wrapper { display: flex; align-items: center; gap: 5px; }
        .nav-tab { padding: 15px 25px; cursor: pointer; border: none; background: none; font-size: 15px; font-weight: 500; color: #6c757d; transition: all 0.3s ease; white-space: nowrap; border-bottom: 3px solid transparent; }
        .nav-tab:hover { background: #e9ecef; color: #495057; }
		.nav-tab.active { color: var(--primary-color, #3498db); border-bottom-color: var(--primary-color, #3498db); background: white; }
		.delete-tab-btn { color: #e74c3c; background: none; border: none; cursor: pointer; font-size: 18px; font-weight: bold; margin-right: 10px; flex-shrink: 0; transition: all 0.2s ease; line-height: 1; padding: 0; width: auto; height: auto; }
		.delete-tab-btn:hover { color: #c0392b; transform: scale(1.2); }
        .add-category-tab { background: #27ae60 !important; color: white !important; font-weight: bold; border-bottom: none !important; padding: 15px 20px !important; font-size: 18px !important; }
        .add-category-tab:hover { background: #229954 !important; }
        .content-area { padding: 30px; }
        .category { display: none; }
        .category.active { display: block; }
        .skill-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .skill-card { background: #f8f9fa; border-radius: 12px; padding: 20px; border-left: 4px solid var(--primary-color, #3498db); transition: all 0.3s ease; }
        .skill-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .skill-title { font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 12px; }
        .category-intro { background: #e3f2fd; padding: 20px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #2196f3; }
        .category-intro h2 { color: #1976d2; margin-bottom: 10px; font-size: 20px; }
        .checklist-item { display: flex; align-items: flex-start; gap: 12px; padding: 12px; background: white; margin-bottom: 10px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; }
        .checklist-item:hover { background: #f0f7ff; }
       	.checkbox { width: 20px; height: 20px; border: 2px solid var(--primary-color, #3498db); border-radius: 4px; flex-shrink: 0; margin-top: 2px; cursor: pointer; transition: all 0.3s ease; }
        .checklist-item.checked .checkbox { background: #27ae60; border-color: #27ae60; position: relative; }
        .checklist-item.checked .checkbox:after { content: "✓"; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 14px; font-weight: bold; }
        .checklist-item.checked { opacity: 0.7; }
        .checklist-text { flex: 1; font-size: 14px; line-height: 1.5; color: #495057; }
        .editable { cursor: text; padding: 2px 4px; border-radius: 4px; transition: all 0.2s ease; }
        .editable:hover { background: rgba(52, 152, 219, 0.1); }
        .editable:focus { outline: 2px solid var(--primary-color, #3498db); background: white; }
		.delete-btn { color: #e74c3c; background: none; border: none; cursor: pointer; font-size: 18px; font-weight: bold; display: none; margin-left: 8px; flex-shrink: 0; transition: all 0.2s ease; line-height: 1; padding: 0; width: auto; height: auto; }
		.delete-btn:hover { color: #c0392b; transform: scale(1.2); }
        .edit-mode .delete-btn { display: inline-flex; }
        .add-item-btn { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-top: 10px; font-size: 14px; font-weight: 600; display: none; width: 100%; }
        .add-item-btn:hover { background: #229954; }
        .edit-mode .add-item-btn { display: block; }
        .add-skill-btn { background: var(--primary-color, #3498db); color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; width: 100%; margin-top: 20px; transition: all 0.3s ease; display: none; }
		.add-skill-btn:hover { background: var(--secondary-color, #2980b9); }
        .edit-mode .add-skill-btn { display: block; }
		.floating-add-btn { position: fixed; bottom: 25px; right: 25px; width: 75px; height: 75px; border-radius: 18px; background-color: var(--primary-color, rgba(52, 152, 219, 0.5)); color: white; font-size: 42px; font-weight: bold; border: none; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); cursor: pointer; transition: all 0.2s ease-in-out; z-index: 1000; }
		.floating-add-btn:hover { transform: scale(1.1); background-color: var(--secondary-color, rgba(41, 128, 185, 0.7)); }
        .edit-mode-active .floating-add-btn { display: none; }
		@media (max-width: 768px) { .skill-grid { grid-template-columns: 1fr; } }
		@keyframes fadeIn {  from { opacity: 0; transform: scale(0.8); }  to { opacity: 1; transform: scale(1); } }
		.floating-add-btn {  animation: fadeIn 0.3s ease-in-out;}

    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <body>
<div class="menu-overlay" id="menuOverlay" onclick="closeGuideMenu()"></div>
		<div class="container">
        <div class="header">
            <div class="edit-toggle"><button class="edit-btn" id="editModeBtn" onclick="toggleEditMode()">Edit</button></div>
            <h1>📚 Essential Life Skills Guide</h1>
            <p>Fundamental knowledge everyone should have to navigate life successfully</p>
        </div>
        <div class="nav-tabs" id="navTabs"></div>
        <div class="content-area" id="contentArea"></div>
    </div>
    <script>
// Initialize Firebase - REPLACE WITH YOUR CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyA5k5pOZjWTrV3b1f51-aWH2AgDUY-p5hE",
  authDomain: "life-akuk095.firebaseapp.com",
  databaseURL: "https://life-akuk095-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "life-akuk095",
  storageBucket: "life-akuk095.firebasestorage.app",
  messagingSenderId: "80383828301",
  appId: "1:80383828301:web:7c001b7375f63fc5055704",
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
let currentGuideId = "defaultGuide"; 
// Default data structure
let categories = [
    {
        name: "Health & Body", 
        icon: "💪", 
        intro: "Understanding your body and maintaining your health.", 
        skills: [
            {
                title: "Basic Hygiene", 
                icon: "🧼", 
                items: ["Brush teeth twice daily", "Shower regularly", "Wash hands before eating"]
            }
        ]
    },
    {
        name: "Daily Living", 
        icon: "🏡", 
        intro: "Practical skills to manage your home and everyday responsibilities.", 
        skills: [
            {
                title: "Household Basics", 
                icon: "🧹", 
                items: ["Do laundry", "Clean regularly", "Take out trash"]
            }
        ]
    }
];

let checkedItems = {};
let editMode = false;
let activeTabIndex = 0;
let appIcon = "📚"; 
let appTitle = "Essential Life Skills Guide";
let appSubtitle = "Fundamental knowledge everyone should have to navigate life successfully";
let themeColor = '#3498db'; // Default blue

const colorThemes = [
    { name: 'Blue', primary: '#3498db', secondary: '#2c3e50' },
    { name: 'Green', primary: '#27ae60', secondary: '#1e8449' },
    { name: 'Purple', primary: '#9b59b6', secondary: '#6c3483' },
    { name: 'Red', primary: '#e74c3c', secondary: '#c0392b' },
    { name: 'Orange', primary: '#e67e22', secondary: '#d35400' },
    { name: 'Teal', primary: '#1abc9c', secondary: '#16a085' },
    { name: 'Pink', primary: '#ff6b9d', secondary: '#c44569' },
    { name: 'Indigo', primary: '#5f27cd', secondary: '#341f97' },
    { name: 'Yellow', primary: '#f39c12', secondary: '#d68910' },
    { name: 'Cyan', primary: '#00bcd4', secondary: '#0097a7' },
    { name: 'Brown', primary: '#795548', secondary: '#5d4037' },
    { name: 'Grey', primary: '#607d8b', secondary: '#455a64' }
];
// Load data from Firebase on startup
function loadFromFirebase() {
    // Hide container initially
    document.querySelector('.container').classList.remove('loaded');
    
    database.ref(`guides/${currentGuideId}`).once('value', (snapshot) => {
        if (!snapshot.exists()) {
            database.ref(`guides/${currentGuideId}`).set({
                appTitle, appSubtitle, appIcon, categories, checkedItems, themeColor
            });
        }
    });

    // Use Promise.all to wait for all data to load
    Promise.all([
        database.ref(`guides/${currentGuideId}/categories`).once('value'),
        database.ref(`guides/${currentGuideId}/checkedItems`).once('value'),
        database.ref(`guides/${currentGuideId}/appTitle`).once('value'),
        database.ref(`guides/${currentGuideId}/appSubtitle`).once('value'),
        database.ref(`guides/${currentGuideId}/appIcon`).once('value'),
        database.ref(`guides/${currentGuideId}/themeColor`).once('value')
    ]).then(([categoriesSnap, checkedSnap, titleSnap, subtitleSnap, iconSnap, themeSnap]) => {
        // Load categories
        if (categoriesSnap.val()) {
            categories = categoriesSnap.val();
        }
        
        // Load checked items
        if (checkedSnap.val()) {
            checkedItems = checkedSnap.val();
        }
        
        // Load app title
        if (titleSnap.val()) {
            appTitle = titleSnap.val();
        }
        
        // Load app subtitle
        if (subtitleSnap.val()) {
            appSubtitle = subtitleSnap.val();
        }
        
        // Load app icon
        if (iconSnap.val() !== null) {
            appIcon = iconSnap.val();
        }
        
        // Load theme color
        if (themeSnap.val()) {
            themeColor = themeSnap.val();
        } else {
    		themeColor = '#3498db'; // Default blue if no theme saved
		}
        
        // Apply theme
        applyTheme();
        
        // Render everything
        renderHeader();
        renderTabs();
        renderContent();
        
        // Show container with fade-in effect
        document.querySelector('.container').classList.add('loaded');
    });
}

function switchGuide(id) {
    currentGuideId = id;
    themeColor = '#3498db';
    loadFromFirebase();
    closeGuideMenu(); // Close menu after switching
}
function applyTheme() {
    const theme = colorThemes.find(t => t.primary === themeColor) || colorThemes[0];
    
    // Update CSS variables
    document.documentElement.style.setProperty('--primary-color', theme.primary);
    document.documentElement.style.setProperty('--secondary-color', theme.secondary);
    
    // Update body background with transparency
    document.body.style.background = `linear-gradient(135deg, ${theme.secondary}CC 0%, ${theme.primary}CC 100%)`;
    // The CC at the end = 80% opacity. Use 99 for 60%, 66 for 40%, etc.
    
    // Update header background
    const header = document.querySelector('.header');
    if (header) {
        header.style.background = `linear-gradient(135deg, ${theme.secondary} 0%, ${theme.primary} 100%)`;
    }
}
function toggleColorPicker(e) {
    e.stopPropagation();
    const picker = document.getElementById('colorPickerMenu');
    picker.classList.toggle('show');
}

function selectColor(color) {
    themeColor = color;
    database.ref(`guides/${currentGuideId}/themeColor`).set(themeColor);
    applyTheme();
    renderHeader(); // Re-render to update selected color
    
    // Close both color picker and dropdown menu
    document.getElementById('colorPickerMenu').classList.remove('show');
    document.getElementById('dropdownMenu').classList.remove('show');
}
function createNewGuide() {
    const id = prompt("Enter a name or ID for this new guide:");
    if (!id) return;
    const newGuide = {
        appTitle: "New Life Skills Guide",
        appSubtitle: "Click to edit subtitle",
        appIcon: "📘",
        categories: [
            {
                name: "New Category",
                icon: "📌",
                intro: "Click to edit this section",
                skills: [
                    { title: "New Skill", icon: "✨", items: ["New item - click to edit"] }
                ]
            }
        ],
        checkedItems: {}
    };
    database.ref(`guides/${id}`).set(newGuide);
    currentGuideId = id;
    loadGuideList();
    loadFromFirebase();
}
function toggleGuideMenu(e) {
    e.stopPropagation();
    const dropdown = document.getElementById('guideDropdown');
    const overlay = document.getElementById('menuOverlay');
    const isCurrentlyShown = dropdown.classList.contains('show');
    
    dropdown.classList.toggle('show');
    overlay.classList.toggle('show');
    document.body.classList.toggle('menu-open');
    
    // Close other menus
    const otherMenu = document.getElementById('dropdownMenu');
    if (otherMenu) otherMenu.classList.remove('show');
    
    // If we just closed it, trigger a re-render to reset button state
    if (isCurrentlyShown) {
        e.target.blur();
    }
}

function toggleMenu(e) {
    e.stopPropagation();
    const menu = document.getElementById('dropdownMenu');
    const isCurrentlyShown = menu.classList.contains('show');
    
    menu.classList.toggle('show');
    
    // Close other menus
    const guideMenu = document.getElementById('guideDropdown');
    if (guideMenu) guideMenu.classList.remove('show');
    
    // If we just closed it, trigger a re-render to reset button state
    if (isCurrentlyShown) {
        // Force button to lose focus
        e.target.blur();
    }
}
function closeGuideMenu() {
    const dropdown = document.getElementById('guideDropdown');
    const overlay = document.getElementById('menuOverlay');
    
    dropdown.classList.remove('show');
    overlay.classList.remove('show');
    document.body.classList.remove('menu-open');
}
function duplicateGuide() {
    const newId = prompt("Enter name for the duplicated guide:");
    if (!newId) return;
    
    database.ref(`guides/${currentGuideId}`).once('value', (snapshot) => {
        const data = snapshot.val();
        database.ref(`guides/${newId}`).set(data);
        currentGuideId = newId;
        loadGuideList();
        loadFromFirebase();
    });
}

function deleteGuide() {
    if (currentGuideId === 'defaultGuide') {
        alert("Cannot delete the default guide!");
        return;
    }
    if (confirm("Delete this entire guide? This cannot be undone.")) {
        database.ref(`guides/${currentGuideId}`).remove();
        currentGuideId = 'defaultGuide';
        loadGuideList();
        loadFromFirebase();
    }
}
function saveHeader() {
  database.ref(`guides/${currentGuideId}/appTitle`).set(appTitle);
  database.ref(`guides/${currentGuideId}/appSubtitle`).set(appSubtitle);
  database.ref(`guides/${currentGuideId}/appIcon`).set(appIcon);
	loadGuideList();
}


function renderHeader() {
    const header = document.querySelector('.header');
    
    // Generate color options HTML
    let colorOptionsHTML = '';
    colorThemes.forEach(theme => {
        const isSelected = theme.primary === themeColor ? 'selected' : '';
        colorOptionsHTML += `
            <div class="color-option ${isSelected}" 
                 style="background: linear-gradient(135deg, ${theme.secondary} 0%, ${theme.primary} 100%);"
                 onclick="selectColor('${theme.primary}')"
                 title="${theme.name}">
            </div>
        `;
    });
    
    header.innerHTML = `
<button class="guide-menu-btn" onclick="toggleGuideMenu(event)">☰</button>
<div class="guide-dropdown" id="guideDropdown">
    <button class="menu-close-btn" onclick="closeGuideMenu()">×</button>
    <div class="menu-header">
        <h3>📚 My Guides</h3>
    </div>
</div>
${editMode ? '<button class="save-btn show" onclick="saveAndExitEdit()">Save</button>' : ''}
<div class="edit-toggle">
    <button class="edit-btn" id="menuBtn" onclick="toggleMenu(event)">⋮</button>
    <div class="dropdown-menu" id="dropdownMenu">
        <button onclick="toggleEditMode()">Edit</button>
        <button onclick="toggleColorPicker(event)">🎨 Theme</button>
        <div class="color-picker-menu" id="colorPickerMenu">
            <h3>Choose Theme Color</h3>
            <div class="color-options">
                ${colorOptionsHTML}
            </div>
        </div>
        <button onclick="duplicateGuide()">Duplicate</button>
        <button onclick="deleteGuide()">Delete</button>
    </div>
</div>
<h1>
    <span class="icon editable-icon" ${editMode ? 'onclick="editAppIcon(this)"' : ''}>
        ${appIcon ? appIcon : "🚫"}
    </span>
    <span class="${editMode ? 'editable' : ''}" contenteditable="${editMode}">
        ${appTitle}
    </span>
</h1>
<p class="${editMode ? 'editable' : ''}" contenteditable="${editMode}">${appSubtitle}</p>
    `;

    // Apply current theme
    applyTheme();

    // Populate guide dropdown
    populateGuideDropdown();

    if (editMode) {
        header.querySelector('h1 span.editable').addEventListener('blur', (e) => {
            appTitle = e.target.textContent.trim();
            saveHeader();
        });
        header.querySelector('p').addEventListener('blur', (e) => {
            appSubtitle = e.target.textContent.trim();
            saveHeader();
        });
    }
}
function populateGuideDropdown() {
    database.ref('guides').once('value', (snapshot) => {
        const guides = snapshot.val() || {};
        const dropdown = document.getElementById('guideDropdown');
        dropdown.innerHTML = '';
        
        for (let id in guides) {
            const title = guides[id].appTitle || id;
            const icon = guides[id].appIcon || '📄';
            const guideTheme = guides[id].themeColor || '#3498db';
            
            const btn = document.createElement('button');
            btn.textContent = `${icon} ${title}`;
            btn.style.borderLeft = `4px solid ${guideTheme}`; // Add colored border
            btn.style.background = `linear-gradient(90deg, ${guideTheme}15 0%, transparent 100%)`; // Subtle gradient background
            
            btn.onclick = () => {
                switchGuide(id);
                dropdown.classList.remove('show');
            };
            
            if (id === currentGuideId) {
                btn.classList.add('current-guide');
            }
            
            dropdown.appendChild(btn);
        }
        
        // Add "New Guide" button at the bottom
        const newBtn = document.createElement('button');
        newBtn.className = 'new-guide-btn';
        newBtn.textContent = '+ New Guide';
        newBtn.onclick = () => {
            createNewGuide();
            dropdown.classList.remove('show');
        };
        dropdown.appendChild(newBtn);
    });
}
function saveAndExitEdit() {
    editMode = false;
    document.body.classList.remove('edit-mode-active');
    renderHeader();
    renderTabs();
    renderContent();
}
function showEmojiPicker(target, callback) {
    // Remove any existing picker
    const oldPicker = document.querySelector('.emoji-picker');
    if (oldPicker) oldPicker.remove();

    const picker = document.createElement('div');
    picker.className = 'emoji-picker';

    const emojis = ["📚","💪","🏡","🧼","🧹","✨","⚡","🔥","💡","📌","😀","😂","😍","🤔","😎","🥳","😢","😡","😱","💀","👻","🤖","👋","👍","🙏","👩‍⚕️","👨‍🚀","💑","🐶","🐱","🐵","🦋","🐢","🐬","🦁","🌹","🌍","🌞","🌈","🌊","🔥","❄️","🍎","🍌","🍕","🍣","🍦","🍫","☕","🍺","⚽","🏀","🎨","🎤","🚗","🚲","✈️","🚀","🏠","🏥","🗽","📱","💻","📚","💡","📌","🔑","💉","💊","🚫"];
    
    emojis.forEach(e => {
        const btn = document.createElement('button');
        btn.textContent = e;
        btn.onclick = (event) => {
            event.stopPropagation(); // Prevent triggering the outside click
            callback(e === "🚫" ? "" : e);
            picker.remove();
            document.removeEventListener('click', outsideClickHandler);
        };
        picker.appendChild(btn);
    });

    document.body.appendChild(picker);

    // Position near target
    const rect = target.getBoundingClientRect();
    picker.style.top = `${rect.bottom + window.scrollY + 5}px`;
    picker.style.left = `${rect.left + window.scrollX}px`;

    // Close picker when clicking outside
    const outsideClickHandler = (event) => {
        if (!picker.contains(event.target) && event.target !== target) {
            picker.remove();
            document.removeEventListener('click', outsideClickHandler);
        }
    };

    // Add listener after a small delay to prevent immediate closing
    setTimeout(() => {
        document.addEventListener('click', outsideClickHandler);
    }, 10);
}
// Save categories to Firebase
function saveCategories() {
    database.ref(`guides/${currentGuideId}/categories`).set(categories);
}

// Save checked items to Firebase
function saveCheckedItems() {
   database.ref(`guides/${currentGuideId}/checkedItems`).set(checkedItems)
}

function renderTabs() { 
    const navTabs = document.getElementById('navTabs'); 
    navTabs.innerHTML = ''; 
    
    categories.forEach((cat, i) => { 
        const tabWrapper = document.createElement('div');
        tabWrapper.className = 'tab-wrapper';
        
        const tab = document.createElement('button'); 
        tab.className = 'nav-tab' + (i === activeTabIndex ? ' active' : ''); 
        tab.textContent = `${cat.icon} ${cat.name}`; 
        tab.onclick = () => switchTab(i); 
        tabWrapper.appendChild(tab);
        
        if (editMode) {
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-tab-btn';
            deleteBtn.textContent = '×';
            deleteBtn.onclick = (e) => {
                e.stopPropagation();
                deleteCategory(i);
            };
            tabWrapper.appendChild(deleteBtn);
        }
        
        navTabs.appendChild(tabWrapper); 
    }); 
    
    if (editMode) {
        const addCategoryBtn = document.createElement('button');
        addCategoryBtn.className = 'nav-tab add-category-tab';
        addCategoryBtn.textContent = '+';
        addCategoryBtn.onclick = addCategory;
        navTabs.appendChild(addCategoryBtn);
    }
}

function renderContent() { 
    const contentArea = document.getElementById('contentArea'); 
    contentArea.innerHTML = ''; 
    contentArea.className = 'content-area' + (editMode ? ' edit-mode' : ''); 
    
    categories.forEach((cat, catIndex) => { 
        const catDiv = document.createElement('div'); 
        catDiv.className = 'category' + (catIndex === activeTabIndex ? ' active' : ''); 
        
        const intro = document.createElement('div'); 
        intro.className = 'category-intro'; 
        const h2 = document.createElement('h2'); 
        h2.innerHTML = `
   		<span class="icon editable-icon" ${editMode ? `onclick="editCategoryIcon(${catIndex}, this)"` : ''}>${cat.icon || ""}</span>
	   <span class="${editMode ? 'editable' : ''}" contenteditable="${editMode}">${cat.name}</span> `;
        const p = document.createElement('p'); 
        p.className = editMode ? 'editable' : ''; 
        p.contentEditable = editMode; 
        p.textContent = cat.intro; 
        intro.appendChild(h2); 
        intro.appendChild(p); 
        
        if (editMode) { 
            h2.querySelector('.editable').addEventListener('blur', (e) => { 
                categories[catIndex].name = e.target.textContent.trim(); 
                saveCategories();
                renderTabs();
            }); 
            p.addEventListener('blur', (e) => { 
                categories[catIndex].intro = e.target.textContent.trim(); 
                saveCategories();
            }); 
        } 
        
        catDiv.appendChild(intro); 
        
        const grid = document.createElement('div'); 
        grid.className = 'skill-grid'; 
        
        cat.skills.forEach((skill, skillIndex) => { 
            const card = document.createElement('div'); 
            card.className = 'skill-card'; 
            
            const titleDiv = document.createElement('div'); 
            titleDiv.className = 'skill-title'; 
            titleDiv.innerHTML = `
   <span class="icon editable-icon" ${editMode ? `onclick="editSkillIcon(${catIndex}, ${skillIndex}, this)"` : ''}>${skill.icon || ""}</span>
   <span class="${editMode ? 'editable' : ''}" contenteditable="${editMode}">${skill.title}</span>
`;

            
            if (editMode) { 
                const deleteSkillBtn = document.createElement('button');
                deleteSkillBtn.className = 'delete-btn';
                deleteSkillBtn.textContent = '×';
                deleteSkillBtn.onclick = () => deleteSkill(catIndex, skillIndex);
                titleDiv.appendChild(deleteSkillBtn);
                
                titleDiv.querySelector('.editable').addEventListener('blur', (e) => { 
                    categories[catIndex].skills[skillIndex].title = e.target.textContent.trim(); 
                    saveCategories();
                }); 
            } 
            
            card.appendChild(titleDiv); 
            
            skill.items.forEach((item, itemIndex) => { 
                const itemId = `${catIndex}-${skillIndex}-${itemIndex}`; 
                const checkItem = document.createElement('div'); 
                checkItem.className = 'checklist-item' + (checkedItems[itemId] ? ' checked' : ''); 
                if (!editMode) checkItem.onclick = () => toggleCheck(itemId); 
                
                const checkbox = document.createElement('div');
                checkbox.className = 'checkbox';
                checkItem.appendChild(checkbox);
                
                const textDiv = document.createElement('div');
                textDiv.className = 'checklist-text' + (editMode ? ' editable' : '');
                textDiv.contentEditable = editMode;
                textDiv.textContent = item;
                checkItem.appendChild(textDiv);
                
                if (editMode) {
                    const deleteItemBtn = document.createElement('button');
                    deleteItemBtn.className = 'delete-btn';
                    deleteItemBtn.textContent = '×';
                    deleteItemBtn.onclick = () => deleteItem(catIndex, skillIndex, itemIndex);
                    checkItem.appendChild(deleteItemBtn);
                    
                    textDiv.addEventListener('blur', (e) => { 
                        categories[catIndex].skills[skillIndex].items[itemIndex] = e.target.textContent.trim(); 
                        saveCategories();
                    }); 
                }
                
                card.appendChild(checkItem); 
            }); 
            
            const addItemBtn = document.createElement('button'); 
            addItemBtn.className = 'add-item-btn'; 
            addItemBtn.textContent = '+ Add Item'; 
            addItemBtn.onclick = () => addItem(catIndex, skillIndex); 
            card.appendChild(addItemBtn); 
            
            grid.appendChild(card); 
        }); 
        
        catDiv.appendChild(grid); 
        
        const addSkillBtn = document.createElement('button'); 
        addSkillBtn.className = 'add-skill-btn'; 
        addSkillBtn.textContent = '+ Add New Card'; 
        addSkillBtn.onclick = () => addSkill(catIndex); 
        catDiv.appendChild(addSkillBtn); 
        
        contentArea.appendChild(catDiv); 
    }); 
}

function switchTab(index) { 
    activeTabIndex = index; 
    renderTabs();
    const cats = document.querySelectorAll('.category'); 
    cats.forEach((cat, i) => cat.classList.toggle('active', i === activeTabIndex)); 
}

function toggleCheck(itemId) { 
    if (editMode) return; 
    checkedItems[itemId] = !checkedItems[itemId]; 
    saveCheckedItems();
    renderContent(); 
}

function toggleEditMode() { 
    const menu = document.getElementById('dropdownMenu');
    if (menu) menu.classList.remove('show'); 
    
    editMode = !editMode; 
    
    // Toggle class on body to hide/show floating button
    if (editMode) {
        document.body.classList.add('edit-mode-active');
    } else {
        document.body.classList.remove('edit-mode-active');
    }
    
    renderHeader();
    renderTabs();
    renderContent(); 
}

function editAppIcon(el) {
    // Check if picker already exists and remove it
    const existingMenu = document.querySelector('.temp-emoji-menu');
    if (existingMenu) {
        existingMenu.remove();
        return; // Toggle off if clicking the same icon
    }

    const emojis = ["📚","💡","🌍","⚙️","❤️","🚀","🎯","💪","🏡","✨","😀","😂","😍","🤔","😎","🥳","😢","😡","😱","💀","👻","🤖","👋","👍","🙏","👩‍⚕️","👨‍🚀","💑","🐶","🐱","🐵","🦋","🐢","🐬","🦁","🌹","🌍","🌞","🌈","🌊","🔥","❄️","🍎","🍌","🍕","🍣","🍦","🍫","☕","🍺","⚽","🏀","🎨","🎤","🚗","🚲","✈️","🚀","🏠","🏥","🗽","📱","💻","📚","💡","📌","🔑","💉","💊","🚫"];
    
    let menu = document.createElement("div");
    menu.className = "temp-emoji-menu"; // Add class for easy selection
    menu.style.position = "absolute";
    menu.style.background = "white";
    menu.style.border = "1px solid #ccc";
    menu.style.padding = "5px";
    menu.style.borderRadius = "8px";
    menu.style.display = "grid";
    menu.style.gridTemplateColumns = "repeat(6, 1fr)";
    menu.style.gap = "5px";
    menu.style.zIndex = 1000;
    menu.style.boxShadow = "0 4px 12px rgba(0,0,0,0.15)";

    emojis.forEach(e => {
        let btn = document.createElement("button");
        btn.textContent = e;
        btn.style.fontSize = "20px";
        btn.style.cursor = "pointer";
        btn.style.background = "none";
        btn.style.border = "none";
        btn.onclick = (event) => {
            event.stopPropagation();
            appIcon = (e === "🚫") ? "" : e;
            saveHeader();
            renderHeader();
            menu.remove();
            document.removeEventListener('click', outsideClickHandler);
        };
        menu.appendChild(btn);
    });

    // Place menu below icon
    const rect = el.getBoundingClientRect();
    menu.style.left = rect.left + "px";
    menu.style.top = rect.bottom + window.scrollY + "px";
    document.body.appendChild(menu);

    // Close menu when clicking outside
    const outsideClickHandler = (event) => {
        if (!menu.contains(event.target) && event.target !== el) {
            menu.remove();
            document.removeEventListener('click', outsideClickHandler);
        }
    };

    // Add listener after a small delay
    setTimeout(() => {
        document.addEventListener('click', outsideClickHandler);
    }, 10);
}
function addSkill(catIndex) { 
    categories[catIndex].skills.push({ 
        title: "New Skill", 
        icon: "✨", 
        items: ["New item - click to edit"] 
    }); 
    saveCategories();
    renderContent(); 
}
function editSkillIcon(catIndex, skillIndex, el) {
    showEmojiPicker(el, (emoji) => {
        categories[catIndex].skills[skillIndex].icon = emoji;
        saveCategories();
        renderContent();
    });
}

function deleteSkill(catIndex, skillIndex) { 
    if (confirm('Delete this skill?')) { 
        categories[catIndex].skills.splice(skillIndex, 1); 
        saveCategories();
        renderContent(); 
    } 
}

function deleteItem(catIndex, skillIndex, itemIndex) { 
    categories[catIndex].skills[skillIndex].items.splice(itemIndex, 1); 
    saveCategories();
    renderContent(); 
}

function addItem(catIndex, skillIndex) { 
    categories[catIndex].skills[skillIndex].items.push("New item"); 
    saveCategories();
    renderContent(); 
}

function addCategory() {
    categories.push({
        name: "New Category",
        icon: "📌",
        intro: "Click to edit this description",
        skills: [
            {
                title: "New Skill",
                icon: "✨",
                items: ["New item - click to edit"]
            }
        ]
    });
    activeTabIndex = categories.length - 1;
    saveCategories();
    renderTabs();
    renderContent();
}

function editCategoryIcon(catIndex, el) {
    showEmojiPicker(el, (emoji) => {
        categories[catIndex].icon = emoji;
        saveCategories();
        renderTabs();
        renderContent();
    });
}

function deleteCategory(catIndex) {
    if (confirm('Delete this entire category?')) {
        categories.splice(catIndex, 1);
        if (activeTabIndex >= categories.length) {
            activeTabIndex = Math.max(0, categories.length - 1);
        }
        saveCategories();
        renderTabs();
        renderContent();
    }
}
// Close menus when clicking outside
document.addEventListener('click', (e) => {
    // Don't close if clicking inside the guide dropdown
    const guideDropdown = document.getElementById('guideDropdown');
    if (guideDropdown && guideDropdown.contains(e.target)) {
        return;
    }
    
    const menu = document.getElementById('dropdownMenu');
    if (menu) menu.classList.remove('show');
    
    const colorMenu = document.getElementById('colorPickerMenu');
    if (colorMenu) colorMenu.classList.remove('show');
});
// Load data when page loads
loadFromFirebase();

    </script>
	<button class="floating-add-btn" onclick="createNewGuide()">+</button>

</body>
</html>





